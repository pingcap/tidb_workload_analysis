Alias: q7
Query: 
SELECT count(DISTINCT from_address) FROM transactions

Original Cost: 1.41E+09
Optimized Cost: 1.13E+09
Cost Reduction Ratio: 0.80


===================== original plan =====================
HashAgg_5              1.00           1410387599.00    root                               funcs:count(distinct ethereum.transactions.from_address)->Column#17    
└─TableReader_8        23996584.00    931414275.06     root                               data:TableFullScan_7                                                   
  └─TableFullScan_7    23996584.00    9640857767.72    cop[tikv]    table:transactions    keep order:false                                                       

===================== optimized plan =====================
HashAgg_5              1.00           1126424688.66    root                                                                     funcs:count(distinct ethereum.transactions.from_address)->Column#17    
└─IndexReader_10       23996584.00    647451364.72     root                                                                     index:IndexFullScan_9                                                  
  └─IndexFullScan_9    23996584.00    5381414112.61    cop[tikv]    table:transactions, index:idx_from_address(from_address)    keep order:false                                                       
  
  




mysql> explain analyze SELECT count(DISTINCT from_address) FROM transactions;
+-------------------------+------------+---------+-----------+--------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------+---------+---------+
| id                      | estRows    | actRows | task      | access object      | execution info                                                                                                                                                                                                                                                                                                                                                                               | operator info                                                       | memory  | disk    |
+-------------------------+------------+---------+-----------+--------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------+---------+---------+
| HashAgg_5               | 1.00       | 1       | root      |                    | time:1.78s, loops:2, RU:39007.489758                                                                                                                                                                                                                                                                                                                                                         | funcs:count(distinct ethereum.transactions.from_address)->Column#17 | 62.3 MB | 0 Bytes |
| └─TableReader_8         | 5395060.00 | 5395060 | root      |                    | time:54.7ms, loops:5325, cop_task: {num: 702, max: 40.3ms, min: 573.6µs, avg: 8.22ms, p95: 30.2ms, max_proc_keys: 33760, p95_proc_keys: 33760, tot_proc: 5.31s, tot_wait: 29.8ms, rpc_num: 702, rpc_time: 5.76s, copr_cache_hit_ratio: 0.00, build_task_duration: 182.4µs, max_distsql_concurrency: 15}                                                                                      | data:TableFullScan_7                                                | 20.6 MB | N/A     |
|   └─TableFullScan_7     | 5395060.00 | 5395060 | cop[tikv] | table:transactions | tikv_task:{proc max:36ms, min:0s, avg: 7.03ms, p80:13ms, p95:26ms, iters:8010, tasks:702}, scan_detail: {total_process_keys: 5395060, total_process_keys_size: 2418613440, total_keys: 5395762, get_snapshot_time: 13.7ms, rocksdb: {delete_skipped_count: 3181102, key_skipped_count: 13970520, block: {cache_hit_count: 103182, read_count: 52, read_byte: 53.9 KB, read_time: 120.7µs}}}  | keep order:false                                                    | N/A     | N/A     |
+-------------------------+------------+---------+-----------+--------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------+---------+---------+
3 rows in set (1.79 sec)

mysql> explain analyze SELECT count(DISTINCT from_address) FROM transactions;
+-------------------------+------------+---------+-----------+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------+---------+---------+
| id                      | estRows    | actRows | task      | access object      | execution info                                                                                                                                                                                                                                                                                                                                                                              | operator info                                                       | memory  | disk    |
+-------------------------+------------+---------+-----------+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------+---------+---------+
| HashAgg_5               | 1.00       | 1       | root      |                    | time:1.9s, loops:2, RU:38953.016308                                                                                                                                                                                                                                                                                                                                                         | funcs:count(distinct ethereum.transactions.from_address)->Column#17 | 62.3 MB | 0 Bytes |
| └─TableReader_8         | 5395060.00 | 5395060 | root      |                    | time:96.7ms, loops:5326, cop_task: {num: 702, max: 50.9ms, min: 166.4µs, avg: 8.25ms, p95: 29.3ms, max_proc_keys: 33760, p95_proc_keys: 33760, tot_proc: 5.32s, tot_wait: 28.6ms, rpc_num: 702, rpc_time: 5.78s, copr_cache_hit_ratio: 0.01, build_task_duration: 132.9µs, max_distsql_concurrency: 15}                                                                                     | data:TableFullScan_7                                                | 21.9 MB | N/A     |
|   └─TableFullScan_7     | 5395060.00 | 5395060 | cop[tikv] | table:transactions | tikv_task:{proc max:47ms, min:0s, avg: 7.16ms, p80:13ms, p95:26ms, iters:8010, tasks:702}, scan_detail: {total_process_keys: 5386004, total_process_keys_size: 2414702171, total_keys: 5386701, get_snapshot_time: 11.2ms, rocksdb: {delete_skipped_count: 3181102, key_skipped_count: 13952413, block: {cache_hit_count: 102980, read_count: 20, read_byte: 21.4 KB, read_time: 32.9µs}}}  | keep order:false                                                    | N/A     | N/A     |
+-------------------------+------------+---------+-----------+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------+---------+---------+
3 rows in set (1.90 sec)








mysql> explain analyze SELECT count(DISTINCT from_address) FROM transactions;
+-------------------------+------------+---------+-----------+----------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------+---------+---------+
| id                      | estRows    | actRows | task      | access object                                            | execution info                                                                                                                                                                                                                                                                                                                                            | operator info                                                       | memory  | disk    |
+-------------------------+------------+---------+-----------+----------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------+---------+---------+
| HashAgg_5               | 1.00       | 1       | root      |                                                          | time:1.43s, loops:2, RU:13805.319099                                                                                                                                                                                                                                                                                                                      | funcs:count(distinct ethereum.transactions.from_address)->Column#17 | 62.3 MB | 0 Bytes |
| └─IndexReader_10        | 5395060.00 | 5395060 | root      |                                                          | time:14.6ms, loops:5281, cop_task: {num: 175, max: 56.6ms, min: 515.9µs, avg: 23.8ms, p95: 44ms, max_proc_keys: 50144, p95_proc_keys: 50144, tot_proc: 3.87s, tot_wait: 11.1ms, rpc_num: 175, rpc_time: 4.17s, copr_cache_hit_ratio: 0.00, build_task_duration: 333.4µs, max_distsql_concurrency: 10}                                                     | index:IndexFullScan_9                                               | 21.5 MB | N/A     |
|   └─IndexFullScan_9     | 5395060.00 | 5395060 | cop[tikv] | table:transactions, index:idx_from_address(from_address) | tikv_task:{proc max:52ms, min:0s, avg: 19.8ms, p80:32ms, p95:39ms, iters:5960, tasks:175}, scan_detail: {total_process_keys: 5395060, total_process_keys_size: 814654060, total_keys: 5395235, get_snapshot_time: 5.25ms, rocksdb: {key_skipped_count: 5395060, block: {cache_hit_count: 533, read_count: 17527, read_byte: 64.4 MB, read_time: 42.5ms}}} | keep order:false                                                    | N/A     | N/A     |
+-------------------------+------------+---------+-----------+----------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------+---------+---------+
3 rows in set (1.45 sec)

mysql> explain analyze SELECT count(DISTINCT from_address) FROM transactions;
+-------------------------+------------+---------+-----------+----------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------+---------+---------+
| id                      | estRows    | actRows | task      | access object                                            | execution info                                                                                                                                                                                                                                                                                           | operator info                                                       | memory  | disk    |
+-------------------------+------------+---------+-----------+----------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------+---------+---------+
| HashAgg_5               | 1.00       | 1       | root      |                                                          | time:1.69s, loops:2, RU:13405.703577                                                                                                                                                                                                                                                                     | funcs:count(distinct ethereum.transactions.from_address)->Column#17 | 62.3 MB | 0 Bytes |
| └─IndexReader_10        | 5395060.00 | 5395060 | root      |                                                          | time:14.6ms, loops:5281, cop_task: {num: 175, max: 52.2ms, min: 222.5µs, avg: 20.2ms, p95: 46.4ms, max_proc_keys: 50144, p95_proc_keys: 50144, tot_proc: 3.21s, tot_wait: 9.71ms, rpc_num: 175, rpc_time: 3.53s, copr_cache_hit_ratio: 0.13, build_task_duration: 50.9µs, max_distsql_concurrency: 10}   | index:IndexFullScan_9                                               | 21.5 MB | N/A     |
|   └─IndexFullScan_9     | 5395060.00 | 5395060 | cop[tikv] | table:transactions, index:idx_from_address(from_address) | tikv_task:{proc max:45ms, min:0s, avg: 16.8ms, p80:26ms, p95:41ms, iters:5960, tasks:175}, scan_detail: {total_process_keys: 5317940, total_process_keys_size: 803008940, total_keys: 5318093, get_snapshot_time: 3.84ms, rocksdb: {key_skipped_count: 5317940, block: {cache_hit_count: 17728}}}        | keep order:false                                                    | N/A     | N/A     |
+-------------------------+------------+---------+-----------+----------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------+---------+---------+
3 rows in set (1.69 sec)