Alias: q10
Query: 
SELECT COUNT(DISTINCT block_receipts) as count
FROM (SELECT block_number AS block_receipts
FROM receipts
WHERE NOT EXISTS (
SELECT block_number
FROM transactions
WHERE block_number = receipts.block_number)) as temp;

Original Cost: 4.72E+09
Optimized Cost: 1.13E+09
Cost Reduction Ratio: 0.24


===================== original plan =====================
HashAgg_11                   1.00           4723356555.02    root                               funcs:count(distinct ethereum.receipts.block_number)->Column#28                                   
└─HashJoin_13                19197267.20    4340177594.41    root                               anti semi join, equal:[eq(ethereum.receipts.block_number, ethereum.transactions.block_number)]    
  ├─TableReader_17(Build)    23996584.00    744028235.45     root                               data:TableFullScan_16                                                                             
  │ └─TableFullScan_16       23996584.00    9639999969.44    cop[tikv]    table:transactions    keep order:false                                                                                  
  └─TableReader_15(Probe)    23996584.00    645527893.32     root                               data:TableFullScan_14                                                                             
    └─TableFullScan_14       23996584.00    8162494837.63    cop[tikv]    table:receipts        keep order:false                                                                                  

===================== optimized plan =====================
HashAgg_11                   1.00           1130736543.10    root                                                                     funcs:count(distinct ethereum.receipts.block_number)->Column#28                                          
└─MergeJoin_13               19197267.20    747557582.49     root                                                                     anti semi join, left key:ethereum.receipts.block_number, right key:ethereum.transactions.block_number    
  ├─IndexReader_27(Build)    23996584.00    361804495.83     root                                                                     index:IndexFullScan_26                                                                                   
  │ └─IndexFullScan_26       23996584.00    3906643875.20    cop[tikv]    table:transactions, index:idx_block_number(block_number)    keep order:true                                                                                          
  └─IndexReader_25(Probe)    23996584.00    361804495.83     root                                                                     index:IndexFullScan_24                                                                                   
    └─IndexFullScan_24       23996584.00    3906643875.20    cop[tikv]    table:receipts, index:idx_block_number(block_number)        keep order:true                                                                                          
    
    
+-------------------------------+------------+---------+-----------+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------+----------+---------+
| id                            | estRows    | actRows | task      | access object      | execution info                                                                                                                                                                                                                                                                                                                                                | operator info                                                                                  | memory   | disk    |
+-------------------------------+------------+---------+-----------+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------+----------+---------+
| HashAgg_11                    | 1.00       | 1       | root      |                    | time:19.9s, loops:2, RU:64171.018541                                                                                                                                                                                                                                                                                                                          | funcs:count(distinct ethereum.receipts.block_number)->Column#28                                | 9.11 KB  | 0 Bytes |
| └─HashJoin_13                 | 4316048.00 | 0       | root      |                    | time:19.9s, loops:1, build_hash_table:{total:654ms, fetch:54ms, build:600ms}, probe:{concurrency:5, total:1m39.6s, max:19.9s, probe:1m36.2s, fetch:3.35s}                                                                                                                                                                                                     | anti semi join, equal:[eq(ethereum.receipts.block_number, ethereum.transactions.block_number)] | 129.7 MB | 0 Bytes |
|   ├─TableReader_17(Build)     | 5395060.00 | 5395060 | root      |                    | time:69.9ms, loops:5325, cop_task: {num: 702, max: 52.8ms, min: 439.8µs, avg: 7.84ms, p95: 31.4ms, max_proc_keys: 33760, p95_proc_keys: 33760, tot_proc: 5.25s, tot_wait: 27.5ms, rpc_num: 702, rpc_time: 5.5s, copr_cache_hit_ratio: 0.00, build_task_duration: 87.3µs, max_distsql_concurrency: 15}                                                         | data:TableFullScan_16                                                                          | 2.91 MB  | N/A     |
|   │ └─TableFullScan_16        | 5395060.00 | 5395060 | cop[tikv] | table:transactions | tikv_task:{proc max:52ms, min:0s, avg: 7.31ms, p80:13ms, p95:30ms, iters:8010, tasks:702}, scan_detail: {total_process_keys: 5395060, total_process_keys_size: 2418613440, total_keys: 5395762, get_snapshot_time: 13.7ms, rocksdb: {key_skipped_count: 10789418, block: {cache_hit_count: 82785, read_count: 32, read_byte: 39.3 KB, read_time: 50.3µs}}}    | keep order:false                                                                               | N/A      | N/A     |
|   └─TableReader_15(Probe)     | 5395060.00 | 5395060 | root      |                    | time:42.3ms, loops:5287, cop_task: {num: 487, max: 74.1ms, min: 458µs, avg: 11.2ms, p95: 46.5ms, max_proc_keys: 50144, p95_proc_keys: 50144, tot_proc: 5.19s, tot_wait: 26.5ms, rpc_num: 487, rpc_time: 5.45s, copr_cache_hit_ratio: 0.00, build_task_duration: 102.9µs, max_distsql_concurrency: 15}                                                         | data:TableFullScan_14                                                                          | 5.76 MB  | N/A     |
|     └─TableFullScan_14        | 5395060.00 | 5395060 | cop[tikv] | table:receipts     | tikv_task:{proc max:71ms, min:0s, avg: 10.4ms, p80:17ms, p95:45ms, iters:7109, tasks:487}, scan_detail: {total_process_keys: 5395060, total_process_keys_size: 1521990568, total_keys: 5395547, get_snapshot_time: 12.6ms, rocksdb: {key_skipped_count: 6927906, block: {cache_hit_count: 1906, read_count: 50307, read_byte: 482.8 MB, read_time: 165.6ms}}} | keep order:false                                                                               | N/A      | N/A     |
+-------------------------------+------------+---------+-----------+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------+----------+---------+
6 rows in set (19.93 sec)

mysql> explain analyze SELECT COUNT(DISTINCT block_receipts) as count FROM (SELECT block_number AS block_receipts FROM receipts WHERE NOT EXISTS ( SELECT block_number FROM transactions WHERE block_number = receipts.block_number)) as temp;
+-------------------------------+------------+---------+-----------+--------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------+----------+---------+
| id                            | estRows    | actRows | task      | access object      | execution info                                                                                                                                                                                                                                                                                                                                               | operator info                                                                                  | memory   | disk    |
+-------------------------------+------------+---------+-----------+--------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------+----------+---------+
| HashAgg_11                    | 1.00       | 1       | root      |                    | time:19.2s, loops:2, RU:63378.806983                                                                                                                                                                                                                                                                                                                         | funcs:count(distinct ethereum.receipts.block_number)->Column#28                                | 9.11 KB  | 0 Bytes |
| └─HashJoin_13                 | 4316048.00 | 0       | root      |                    | time:19.2s, loops:1, build_hash_table:{total:641.5ms, fetch:51.8ms, build:589.7ms}, probe:{concurrency:5, total:1m36s, max:19.2s, probe:1m32.7s, fetch:3.29s}                                                                                                                                                                                                | anti semi join, equal:[eq(ethereum.receipts.block_number, ethereum.transactions.block_number)] | 129.7 MB | 0 Bytes |
|   ├─TableReader_17(Build)     | 5395060.00 | 5395060 | root      |                    | time:70.1ms, loops:5325, cop_task: {num: 702, max: 51.6ms, min: 220.8µs, avg: 8.06ms, p95: 33.1ms, max_proc_keys: 33760, p95_proc_keys: 33760, tot_proc: 5.4s, tot_wait: 27.8ms, rpc_num: 702, rpc_time: 5.65s, copr_cache_hit_ratio: 0.01, build_task_duration: 81.5µs, max_distsql_concurrency: 15}                                                        | data:TableFullScan_16                                                                          | 2.48 MB  | N/A     |
|   │ └─TableFullScan_16        | 5395060.00 | 5395060 | cop[tikv] | table:transactions | tikv_task:{proc max:49ms, min:0s, avg: 7.55ms, p80:13ms, p95:31ms, iters:8010, tasks:702}, scan_detail: {total_process_keys: 5384980, total_process_keys_size: 2414239765, total_keys: 5385677, get_snapshot_time: 13.8ms, rocksdb: {key_skipped_count: 10769263, block: {cache_hit_count: 82613, read_count: 62, read_byte: 69.8 KB, read_time: 102.7µs}}}  | keep order:false                                                                               | N/A      | N/A     |
|   └─TableReader_15(Probe)     | 5395060.00 | 5395060 | root      |                    | time:41.1ms, loops:5283, cop_task: {num: 487, max: 47.3ms, min: 184.3µs, avg: 6.72ms, p95: 27.3ms, max_proc_keys: 50144, p95_proc_keys: 50144, tot_proc: 3.02s, tot_wait: 25.6ms, rpc_num: 487, rpc_time: 3.27s, copr_cache_hit_ratio: 0.01, build_task_duration: 63.4µs, max_distsql_concurrency: 15}                                                       | data:TableFullScan_14                                                                          | 6.01 MB  | N/A     |
|     └─TableFullScan_14        | 5395060.00 | 5395060 | cop[tikv] | table:receipts     | tikv_task:{proc max:45ms, min:0s, avg: 6.03ms, p80:9ms, p95:25ms, iters:7109, tasks:487}, scan_detail: {total_process_keys: 5382996, total_process_keys_size: 1518592123, total_keys: 5383476, get_snapshot_time: 11.9ms, rocksdb: {key_skipped_count: 6912404, block: {cache_hit_count: 51981, read_count: 58, read_byte: 53.6 KB, read_time: 85.2µs}}}     | keep order:false                                                                               | N/A      | N/A     |
+-------------------------------+------------+---------+-----------+--------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------+----------+---------+
6 rows in set (19.22 sec)








mysql> explain analyze SELECT COUNT(DISTINCT block_receipts) as count FROM (SELECT block_number AS block_receipts FROM receipts WHERE NOT EXISTS ( SELECT block_number FROM transactions WHERE block_number = receipts.block_number)) as temp;
+-------------------------------+------------+---------+-----------+----------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------+---------+---------+
| id                            | estRows    | actRows | task      | access object                                            | execution info                                                                                                                                                                                                                                                                                           | operator info                                                                                         | memory  | disk    |
+-------------------------------+------------+---------+-----------+----------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------+---------+---------+
| HashAgg_11                    | 1.00       | 1       | root      |                                                          | time:1.14s, loops:2, RU:6470.485094                                                                                                                                                                                                                                                                      | funcs:count(distinct ethereum.receipts.block_number)->Column#28                                       | 9.11 KB | 0 Bytes |
| └─MergeJoin_13                | 4316048.00 | 0       | root      |                                                          | time:1.14s, loops:1                                                                                                                                                                                                                                                                                      | anti semi join, left key:ethereum.receipts.block_number, right key:ethereum.transactions.block_number | 57.7 KB | 0 Bytes |
|   ├─IndexReader_27(Build)     | 5395060.00 | 5395060 | root      |                                                          | time:646.9ms, loops:5708, cop_task: {num: 149, max: 37.5ms, min: 135.3µs, avg: 11.5ms, p95: 25.8ms, max_proc_keys: 50144, p95_proc_keys: 50144, tot_proc: 1.66s, tot_wait: 5.19ms, rpc_num: 149, rpc_time: 1.72s, copr_cache_hit_ratio: 0.26, build_task_duration: 17.3µs, max_distsql_concurrency: 2}   | index:IndexFullScan_26                                                                                | 10.9 MB | N/A     |
|   │ └─IndexFullScan_26        | 5395060.00 | 5395060 | cop[tikv] | table:transactions, index:idx_block_number(block_number) | tikv_task:{proc max:39ms, min:0s, avg: 16.2ms, p80:22ms, p95:33ms, iters:5858, tasks:149}, scan_detail: {total_process_keys: 3759924, total_process_keys_size: 172956504, total_keys: 3760035, get_snapshot_time: 1.82ms, rocksdb: {key_skipped_count: 3759924, block: {cache_hit_count: 4939}}}         | keep order:true                                                                                       | N/A     | N/A     |
|   └─IndexReader_25(Probe)     | 5395060.00 | 5395060 | root      |                                                          | time:87.8ms, loops:5275, cop_task: {num: 149, max: 37.7ms, min: 123.1µs, avg: 11.1ms, p95: 25.6ms, max_proc_keys: 50144, p95_proc_keys: 50144, tot_proc: 1.6s, tot_wait: 4.97ms, rpc_num: 149, rpc_time: 1.66s, copr_cache_hit_ratio: 0.26, build_task_duration: 25µs, max_distsql_concurrency: 2}       | index:IndexFullScan_24                                                                                | 12.1 MB | N/A     |
|     └─IndexFullScan_24        | 5395060.00 | 5395060 | cop[tikv] | table:receipts, index:idx_block_number(block_number)     | tikv_task:{proc max:37ms, min:0s, avg: 15.7ms, p80:22ms, p95:28ms, iters:5858, tasks:149}, scan_detail: {total_process_keys: 3709780, total_process_keys_size: 170649880, total_keys: 3709890, get_snapshot_time: 1.77ms, rocksdb: {key_skipped_count: 3709780, block: {cache_hit_count: 4765}}}         | keep order:true                                                                                       | N/A     | N/A     |
+-------------------------------+------------+---------+-----------+----------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------+---------+---------+
6 rows in set (1.14 sec)

mysql> explain analyze SELECT COUNT(DISTINCT block_receipts) as count FROM (SELECT block_number AS block_receipts FROM receipts WHERE NOT EXISTS ( SELECT block_number FROM transactions WHERE block_number = receipts.block_number)) as temp;
+-------------------------------+------------+---------+-----------+----------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------+---------+---------+
| id                            | estRows    | actRows | task      | access object                                            | execution info                                                                                                                                                                                                                                                                                         | operator info                                                                                         | memory  | disk    |
+-------------------------------+------------+---------+-----------+----------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------+---------+---------+
| HashAgg_11                    | 1.00       | 1       | root      |                                                          | time:1.19s, loops:2, RU:6468.249542                                                                                                                                                                                                                                                                    | funcs:count(distinct ethereum.receipts.block_number)->Column#28                                       | 9.11 KB | 0 Bytes |
| └─MergeJoin_13                | 4316048.00 | 0       | root      |                                                          | time:1.19s, loops:1                                                                                                                                                                                                                                                                                    | anti semi join, left key:ethereum.receipts.block_number, right key:ethereum.transactions.block_number | 57.7 KB | 0 Bytes |
|   ├─IndexReader_27(Build)     | 5395060.00 | 5395060 | root      |                                                          | time:645.9ms, loops:5708, cop_task: {num: 149, max: 33.8ms, min: 139.8µs, avg: 11.7ms, p95: 32ms, max_proc_keys: 50144, p95_proc_keys: 50144, tot_proc: 1.68s, tot_wait: 5.24ms, rpc_num: 149, rpc_time: 1.74s, copr_cache_hit_ratio: 0.26, build_task_duration: 19.7µs, max_distsql_concurrency: 2}   | index:IndexFullScan_26                                                                                | 12.1 MB | N/A     |
|   │ └─IndexFullScan_26        | 5395060.00 | 5395060 | cop[tikv] | table:transactions, index:idx_block_number(block_number) | tikv_task:{proc max:39ms, min:0s, avg: 16.3ms, p80:25ms, p95:31ms, iters:5858, tasks:149}, scan_detail: {total_process_keys: 3709780, total_process_keys_size: 170649880, total_keys: 3709890, get_snapshot_time: 1.88ms, rocksdb: {key_skipped_count: 3709780, block: {cache_hit_count: 4875}}}       | keep order:true                                                                                       | N/A     | N/A     |
|   └─IndexReader_25(Probe)     | 5395060.00 | 5395060 | root      |                                                          | time:138.3ms, loops:5275, cop_task: {num: 149, max: 38ms, min: 134.3µs, avg: 11.7ms, p95: 30.8ms, max_proc_keys: 50144, p95_proc_keys: 50144, tot_proc: 1.68s, tot_wait: 4.93ms, rpc_num: 149, rpc_time: 1.74s, copr_cache_hit_ratio: 0.26, build_task_duration: 26.6µs, max_distsql_concurrency: 2}   | index:IndexFullScan_24                                                                                | 12.1 MB | N/A     |
|     └─IndexFullScan_24        | 5395060.00 | 5395060 | cop[tikv] | table:receipts, index:idx_block_number(block_number)     | tikv_task:{proc max:37ms, min:0s, avg: 16.3ms, p80:23ms, p95:32ms, iters:5858, tasks:149}, scan_detail: {total_process_keys: 3709780, total_process_keys_size: 170649880, total_keys: 3709890, get_snapshot_time: 1.81ms, rocksdb: {key_skipped_count: 3709780, block: {cache_hit_count: 4765}}}       | keep order:true                                                                                       | N/A     | N/A     |
+-------------------------------+------------+---------+-----------+----------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------+---------+---------+
6 rows in set (1.20 sec)