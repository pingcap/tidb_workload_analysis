Alias: q8
Query: 
SELECT
sum(`value`) AS totalamount,
count(`value`) AS transactioncount,
from_address AS fromaddress
FROM transactions
WHERE to_address = '0xfeadad412ec5b5f62afe4b6f39a168eb5f098f41' AND
block_timestamp >= 1499637035 AND block_timestamp <= 1499639599 AND `value` > 1008000000000000
GROUP BY from_address
ORDER BY sum(value) DESC
LIMIT 10

Original Cost: 9.62E+08
Optimized Cost: 8.02E+06
Cost Reduction Ratio: 0.01


===================== original plan =====================
TopN_12                     1.00           962064319.95      root                               Column#17:desc, offset:0, count:10                                                                                                                                                                                                                     
└─HashAgg_19                1.00           962063984.19      root                               group by:ethereum.transactions.from_address, funcs:sum(ethereum.transactions.value)->Column#17, funcs:count(ethereum.transactions.value)->Column#18, funcs:firstrow(ethereum.transactions.from_address)->ethereum.transactions.from_address            
  └─TableReader_26          0.00           962062463.78      root                               data:Selection_25                                                                                                                                                                                                                                      
    └─Selection_25          0.00           14430936956.18    cop[tikv]                          eq(ethereum.transactions.to_address, "0xfeadad412ec5b5f62afe4b6f39a168eb5f098f41"), ge(ethereum.transactions.block_timestamp, 1499637035), gt(ethereum.transactions.value, 1008000000000000), le(ethereum.transactions.block_timestamp, 1499639599)    
      └─TableFullScan_24    23996584.00    9641218789.78     cop[tikv]    table:transactions    keep order:false                                                                                                                                                                                                                                       

===================== optimized plan =====================
TopN_12                      1.00       8018239.22    root                                                                                                               Column#17:desc, offset:0, count:10                                                                                                                                                                         
└─HashAgg_29                 1.00       8017903.46    root                                                                                                               group by:ethereum.transactions.from_address, funcs:sum(Column#26)->Column#17, funcs:count(Column#27)->Column#18, funcs:firstrow(ethereum.transactions.from_address)->ethereum.transactions.from_address    
  └─IndexLookUp_30           1.00       8016333.10    root                                                                                                                                                                                                                                                                                                                          
    ├─Selection_28(Build)    4009.62    2000835.48    cop[tikv]                                                                                                          gt(ethereum.transactions.value, 1008000000000000)                                                                                                                                                          
    │ └─IndexRangeScan_26    5999.15    1701478.09    cop[tikv]    table:transactions, index:idx_to_address_block_timestamp_value(to_address, block_timestamp, value)    range:["0xfeadad412ec5b5f62afe4b6f39a168eb5f098f41" 1499637035,"0xfeadad412ec5b5f62afe4b6f39a168eb5f098f41" 1499639599], keep order:false                                                                  
    └─HashAgg_18(Probe)      1.00       1772950.02    cop[tikv]                                                                                                          group by:ethereum.transactions.from_address, funcs:sum(ethereum.transactions.value)->Column#26, funcs:count(ethereum.transactions.value)->Column#27                                                        
      └─TableRowIDScan_27    4009.62    1610965.30    cop[tikv]    table:transactions                                                                                    keep order:false                                                                                                                                                                                           




mysql> explain analyze SELECT sum(`value`) AS totalamount, count(`value`) AS transactioncount, from_address AS fromaddress FROM transactions WHERE to_address = '0xfeadad412ec5b5f62afe4b6f39a168eb5f098f41' AND block_timestamp >= 1499637035 AND block_timestamp <= 1499639599 AND `value` > 1008000000000000 GROUP BY from_address ORDER BY sum(value) DESC LIMIT 10;
+------------------------------+------------+---------+-----------+--------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+------+
| id                           | estRows    | actRows | task      | access object      | execution info                                                                                                                                                                                                                                                                                                                                                     | operator info                                                                                                                                                                                                                                       | memory  | disk |
+------------------------------+------------+---------+-----------+--------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+------+
| TopN_12                      | 1.00       | 1       | root      |                    | time:158.1ms, loops:2, RU:11398.568034                                                                                                                                                                                                                                                                                                                             | Column#17:desc, offset:0, count:10                                                                                                                                                                                                                  | 2.40 KB | N/A  |
| └─HashAgg_19                 | 1.00       | 1       | root      |                    | time:158.1ms, loops:3, partial_worker:{wall_time:158.026777ms, concurrency:5, task_num:1, tot_wait:789.7957ms, tot_exec:37.764µs, tot_time:789.843896ms, max:157.973953ms, p95:157.973953ms}, final_worker:{wall_time:158.063788ms, concurrency:5, task_num:1, tot_wait:790.02221ms, tot_exec:27.957µs, tot_time:790.053217ms, max:158.02073ms, p95:158.02073ms}   | group by:ethereum.transactions.from_address, funcs:sum(ethereum.transactions.value)->Column#17, funcs:count(ethereum.transactions.value)->Column#18, funcs:firstrow(ethereum.transactions.from_address)->ethereum.transactions.from_address         | 41.4 KB | N/A  |
|   └─TableReader_26           | 0.00       | 1       | root      |                    | time:157.9ms, loops:2, cop_task: {num: 71, max: 94.2ms, min: 170.1µs, avg: 22.6ms, p95: 82.4ms, max_proc_keys: 81748, p95_proc_keys: 79504, tot_proc: 1.58s, tot_wait: 2.28ms, rpc_num: 71, rpc_time: 1.6s, copr_cache_hit_ratio: 0.70, build_task_duration: 148.5µs, max_distsql_concurrency: 15}                                                                 | data:Selection_25                                                                                                                                                                                                                                   | 2.29 KB | N/A  |
|     └─Selection_25           | 0.00       | 1       | cop[tikv] |                    | tikv_task:{proc max:141ms, min:60ms, avg: 86.2ms, p80:96ms, p95:129ms, iters:5587, tasks:71}, scan_detail: {total_process_keys: 1585815, total_process_keys_size: 710384849, total_keys: 1585836, get_snapshot_time: 965.4µs, rocksdb: {key_skipped_count: 3171609, block: {cache_hit_count: 21736}}}                                                              | eq(ethereum.transactions.to_address, "0xfeadad412ec5b5f62afe4b6f39a168eb5f098f41"), ge(ethereum.transactions.block_timestamp, 1499637035), gt(ethereum.transactions.value, 1008000000000000), le(ethereum.transactions.block_timestamp, 1499639599) | N/A     | N/A  |
|       └─TableFullScan_24     | 5395060.00 | 5395060 | cop[tikv] | table:transactions | tikv_task:{proc max:133ms, min:55ms, avg: 78.9ms, p80:90ms, p95:119ms, iters:5587, tasks:71}                                                                                                                                                                                                                                                                       | keep order:false                                                                                                                                                                                                                                    | N/A     | N/A  |
+------------------------------+------------+---------+-----------+--------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+------+
5 rows in set (0.16 sec)

mysql> explain analyze SELECT sum(`value`) AS totalamount, count(`value`) AS transactioncount, from_address AS fromaddress FROM transactions WHERE to_address = '0xfeadad412ec5b5f62afe4b6f39a168eb5f098f41' AND block_timestamp >= 1499637035 AND block_timestamp <= 1499639599 AND `value` > 1008000000000000 GROUP BY from_address ORDER BY sum(value) DESC LIMIT 10;
+------------------------------+------------+---------+-----------+--------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+------+
| id                           | estRows    | actRows | task      | access object      | execution info                                                                                                                                                                                                                                                                                                                                                         | operator info                                                                                                                                                                                                                                       | memory  | disk |
+------------------------------+------------+---------+-----------+--------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+------+
| TopN_12                      | 1.00       | 1       | root      |                    | time:183.2ms, loops:2, RU:11494.453879                                                                                                                                                                                                                                                                                                                                 | Column#17:desc, offset:0, count:10                                                                                                                                                                                                                  | 2.40 KB | N/A  |
| └─HashAgg_19                 | 1.00       | 1       | root      |                    | time:183.1ms, loops:3, partial_worker:{wall_time:183.106369ms, concurrency:5, task_num:1, tot_wait:915.246761ms, tot_exec:34.009µs, tot_time:915.289093ms, max:183.068424ms, p95:183.068424ms}, final_worker:{wall_time:183.137695ms, concurrency:5, task_num:1, tot_wait:915.505608ms, tot_exec:28.45µs, tot_time:915.537301ms, max:183.115557ms, p95:183.115557ms}   | group by:ethereum.transactions.from_address, funcs:sum(ethereum.transactions.value)->Column#17, funcs:count(ethereum.transactions.value)->Column#18, funcs:firstrow(ethereum.transactions.from_address)->ethereum.transactions.from_address         | 42.1 KB | N/A  |
|   └─TableReader_26           | 0.00       | 1       | root      |                    | time:183ms, loops:2, cop_task: {num: 71, max: 135.1ms, min: 229.1µs, avg: 26.7ms, p95: 99.3ms, max_proc_keys: 81748, p95_proc_keys: 79504, tot_proc: 1.86s, tot_wait: 2.6ms, rpc_num: 71, rpc_time: 1.9s, copr_cache_hit_ratio: 0.70, build_task_duration: 135.8µs, max_distsql_concurrency: 15}                                                                       | data:Selection_25                                                                                                                                                                                                                                   | 1.84 KB | N/A  |
|     └─Selection_25           | 0.00       | 1       | cop[tikv] |                    | tikv_task:{proc max:141ms, min:55ms, avg: 90.3ms, p80:104ms, p95:131ms, iters:5587, tasks:71}, scan_detail: {total_process_keys: 1585815, total_process_keys_size: 710384849, total_keys: 1585836, get_snapshot_time: 1.01ms, rocksdb: {key_skipped_count: 3171609, block: {cache_hit_count: 21736}}}                                                                  | eq(ethereum.transactions.to_address, "0xfeadad412ec5b5f62afe4b6f39a168eb5f098f41"), ge(ethereum.transactions.block_timestamp, 1499637035), gt(ethereum.transactions.value, 1008000000000000), le(ethereum.transactions.block_timestamp, 1499639599) | N/A     | N/A  |
|       └─TableFullScan_24     | 5395060.00 | 5395060 | cop[tikv] | table:transactions | tikv_task:{proc max:133ms, min:50ms, avg: 82.3ms, p80:95ms, p95:122ms, iters:5587, tasks:71}                                                                                                                                                                                                                                                                           | keep order:false                                                                                                                                                                                                                                    | N/A     | N/A  |
+------------------------------+------------+---------+-----------+--------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+------+
5 rows in set (0.18 sec)













mysql> explain analyze SELECT sum(`value`) AS totalamount, count(`value`) AS transactioncount, from_address AS fromaddress FROM transactions WHERE to_address = '0xfeadad412ec5b5f62afe4b6f39a168eb5f098f41' AND block_timestamp >= 1499637035 AND block_timestamp <= 1499639599 AND `value` > 1008000000000000 GROUP BY from_address ORDER BY sum(value) DESC LIMIT 10;
+------------------------------------+---------+---------+-----------+----------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------+------+
| id                                 | estRows | actRows | task      | access object                                                                                      | execution info                                                                                                                                                                                                                                                                                                                                                                                                                                   | operator info                                                                                                                                                                                                                               | memory   | disk |
+------------------------------------+---------+---------+-----------+----------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------+------+
| TopN_12                            | 1.00    | 1       | root      |                                                                                                    | time:1.29ms, loops:2, RU:1.011895                                                                                                                                                                                                                                                                                                                                                                                                                | Column#17:desc, offset:0, count:10                                                                                                                                                                                                          | 2.40 KB  | N/A  |
| └─HashAgg_19                       | 1.00    | 1       | root      |                                                                                                    | time:1.27ms, loops:3, partial_worker:{wall_time:1.228989ms, concurrency:5, task_num:1, tot_wait:5.980025ms, tot_exec:16.206µs, tot_time:6.003586ms, max:1.210449ms, p95:1.210449ms}, final_worker:{wall_time:1.25865ms, concurrency:5, task_num:1, tot_wait:6.132046ms, tot_exec:23.855µs, tot_time:6.159925ms, max:1.237879ms, p95:1.237879ms}                                                                                                  | group by:ethereum.transactions.from_address, funcs:sum(ethereum.transactions.value)->Column#17, funcs:count(ethereum.transactions.value)->Column#18, funcs:firstrow(ethereum.transactions.from_address)->ethereum.transactions.from_address | 254.5 KB | N/A  |
|   └─IndexLookUp_37                 | 0.07    | 1       | root      |                                                                                                    | time:1.16ms, loops:2, index_task: {total_time: 463.3µs, fetch_handle: 458.6µs, build: 811ns, wait: 3.87µs}, table_task: {total_time: 571.6µs, num: 1, concurrency: 5}, next: {wait_index: 542.9µs, wait_table_lookup_build: 57.1µs, wait_table_lookup_resp: 511.6µs}                                                                                                                                                                             |                                                                                                                                                                                                                                             | 51.5 KB  | N/A  |
|     ├─Selection_36(Build)          | 0.07    | 1       | cop[tikv] |                                                                                                    | time:450.2µs, loops:3, cop_task: {num: 1, max: 382.6µs, proc_keys: 1, tot_proc: 72.4µs, tot_wait: 37.7µs, rpc_num: 1, rpc_time: 367.2µs, copr_cache_hit_ratio: 0.00, build_task_duration: 17.1µs, max_distsql_concurrency: 1}, tikv_task:{time:0s, loops:1}, scan_detail: {total_process_keys: 1, total_process_keys_size: 216, total_keys: 2, get_snapshot_time: 15.8µs, rocksdb: {key_skipped_count: 1, block: {cache_hit_count: 3}}}          | gt(ethereum.transactions.value, 1008000000000000)                                                                                                                                                                                           | N/A      | N/A  |
|     │ └─IndexRangeScan_34          | 0.09    | 1       | cop[tikv] | table:transactions, index:idx_to_address_block_timestamp_value(to_address, block_timestamp, value) | tikv_task:{time:0s, loops:1}                                                                                                                                                                                                                                                                                                                                                                                                                     | range:["0xfeadad412ec5b5f62afe4b6f39a168eb5f098f41" 1499637035,"0xfeadad412ec5b5f62afe4b6f39a168eb5f098f41" 1499639599], keep order:false                                                                                                   | N/A      | N/A  |
|     └─TableRowIDScan_35(Probe)     | 0.07    | 1       | cop[tikv] | table:transactions                                                                                 | time:493µs, loops:2, cop_task: {num: 1, max: 438.1µs, proc_keys: 1, tot_proc: 87.7µs, tot_wait: 50.9µs, rpc_num: 1, rpc_time: 424.9µs, copr_cache_hit_ratio: 0.00, build_task_duration: 25.9µs, max_distsql_concurrency: 1, max_extra_concurrency: 1}, tikv_task:{time:0s, loops:1}, scan_detail: {total_process_keys: 1, total_process_keys_size: 343, total_keys: 1, get_snapshot_time: 24.8µs, rocksdb: {block: {cache_hit_count: 5}}}        | keep order:false                                                                                                                                                                                                                            | N/A      | N/A  |
+------------------------------------+---------+---------+-----------+----------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------